<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • r4MAS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction">
<meta property="og:description" content="r4MAS">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">r4MAS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../2020_MAS_SDD_July_29.pdf">
    <span class="fas fa-book fa-lg"></span>
     
    Design Document
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="far fa-file-code fa-lg"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/nmfs-fish-tools/RMAS/">
    <span class="fab fa-github fa-lg"></span>
     
    Source Code
  </a>
</li>
<li>
  <a href="https://github.com/nmfs-fish-tools/RMAS/issues/">
    <span class="fas fa-question-circle fa-lg"></span>
     
    Issues
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-contract fa-lg"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/001_Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/002_ModelComparisonProjectExample.html">Model Comparison Project Example</a>
    </li>
    <li>
      <a href="../articles/003_ASAPCaseStudy.html">ASAP Case Study</a>
    </li>
    <li>
      <a href="../articles/004_SSCaseStudy.html">SS Case Study</a>
    </li>
    <li>
      <a href="../articles/005_MetapopulationCaseStudy.html">Metapopulation Case Study</a>
    </li>
    <li>
      <a href="../articles/Architecture.html">MAS Demo Notebook</a>
    </li>
    <li>
      <a href="../articles/CreatingInputJson.html">PlottingMASoutput</a>
    </li>
    <li>
      <a href="../articles/UserManual.html">Meta-population Assessmsnt System User Manual</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="001_Introduction_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nmfs-fish-tools/r4MAS/blob/master/../../../vignettes/001_Introduction.Rmd"><code>../../../vignettes/001_Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>001_Introduction.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This package allows you to build and run a Metapopulation Assessment System (MAS) stock assessment model directly from R. It also includes functions to inter-translate between different assessment platforms. In this vignette, we detail how to set up a MAS model and run it from R using dummy data included in the package. It is straightforward to replace this with your own data.</p>
<p>The first step is to ensure you have <code>Rcpp</code>, the R package that allows calling of C++ code directly from R, and <code>jsonlite</code>, the R package that facilitates reading input and output files from JSON format. Right now, the <code>r4MAS</code> package is only available on Github so you need to install it with the <code>remotes</code> package (this package is included in <code>devtools</code> if you have already installed that.)</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## install.packages("Rcpp")</span>
<span class="co">## install.packages("jsonlite")</span>
<span class="co">## install.packages("remotes")</span>

<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"nmfs-fish-tools/r4MAS"</span><span class="op">)</span></code></pre></div>
<p>Next, you will need to load the .dll included in the r4MAS package.</p>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## Warning: package 'Rcpp' was built under R version 4.0.5</code></pre>
<pre><code>## Loading required package: r4MAS</code></pre>
</div>
<div id="setting-model-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-model-specifications" class="anchor"></a>Setting model specifications</h2>
<p>Next, we define model scalars, such as the number of years of the model, the number of seasons, and the vector of ages. For this example, we will use the test data created by <code>rmas::write_test_data()</code>, but this can be replaced by user input data later on in the script.</p>
<p>r4MAS uses classes to parallel the object-oriented structure of MAS. In R, model classes are initialized using the <code>new()</code> command. For each model component, the associated class is initialized and then its attributes are populated. To view available attributes for each class, use the <code>show()</code> function as shown below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># View attributes and methods associated with each class</span>
<span class="fu">show</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Area</span><span class="op">)</span></code></pre></div>
<pre><code>## C++ class 'Area' &lt;000000001e7d9970&gt;
## Constructors:
##     Area()
## 
## Fields: 
##     int id
##     std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt; name
## 
## Methods: no methods exposed by this class</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># define area</span>
<span class="va">area1</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Area</span><span class="op">)</span>
<span class="va">area1</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="st">"area1"</span></code></pre></div>
</div>
<div id="setting-parameter-values" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-parameter-values" class="anchor"></a>Setting parameter values</h2>
<p>Next, we populate the parameter constructors for each different set of parameters: recruitment, growth, maturity, mortality, and movement. For functions with several parameters (e.g. the Beverton-Holt recruitment function), the <code><a href="../reference/create_par_section.html">create_par_section()</a></code> function exists. This takes a number of arguments: the type of section, the associated object created for that function, then a series of vectors of length equivalent to the number of parameters. These vectors denote the name, lower bound, upper bound, units, phase, and value for each parameter. If any parameter doesn’t have one of these attributes, you can use an NA in the vector. Or, if one of the attributes is not defined for all attributes (e.g. units in this case), you can pass a single NA for that attribute or leave the argument blank.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Recruitment</span>
<span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">BevertonHoltRecruitment</span><span class="op">)</span>

<span class="va">devs_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">22</span><span class="op">)</span><span class="op">)</span>
<span class="va">recruitment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_par_section.html">create_par_section</a></span><span class="op">(</span>
  section_type <span class="op">=</span> <span class="st">"recruitment"</span>, section_type_object <span class="op">=</span> <span class="va">recruitment</span>, par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"R0"</span>, <span class="st">"h"</span>, <span class="st">"sigma_r"</span>, <span class="st">"recdevs"</span><span class="op">)</span>,
  par_lo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.2001</span>, <span class="cn">NA</span>, <span class="op">-</span><span class="fl">15</span><span class="op">)</span>, par_hi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1.0</span>, <span class="cn">NA</span>, <span class="fl">15</span><span class="op">)</span>, par_units <span class="op">=</span> <span class="cn">NA</span>, par_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, par_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">0.75</span>, <span class="fl">0.55</span>, <span class="cn">NA</span><span class="op">)</span>,
  rec_devs <span class="op">=</span> <span class="va">devs_list</span>
<span class="op">)</span>


<span class="co"># Initial Deviations</span>
<span class="va">initial_deviations</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">InitialDeviations</span><span class="op">)</span>
<span class="va">initial_deviations</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="va">nages</span><span class="op">)</span>
<span class="va">initial_deviations</span><span class="op">$</span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">initial_deviations</span><span class="op">$</span><span class="va">phase</span> <span class="op">&lt;-</span> <span class="fl">1</span>


<span class="co"># Growth</span>
<span class="va">growth</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">VonBertalanffyModified</span><span class="op">)</span>
<span class="va">empirical_weight</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">ewaa</span>
<span class="va">growth</span><span class="op">$</span><span class="fu">SetUndifferentiatedCatchWeight</span><span class="op">(</span><span class="va">empirical_weight</span><span class="op">)</span>
<span class="va">growth</span><span class="op">$</span><span class="fu">SetUndifferentiatedSurveyWeight</span><span class="op">(</span><span class="va">empirical_weight</span><span class="op">)</span>
<span class="va">growth</span><span class="op">$</span><span class="fu">SetUndifferentiatedWeightAtSeasonStart</span><span class="op">(</span><span class="va">empirical_weight</span><span class="op">)</span>
<span class="va">growth</span><span class="op">$</span><span class="fu">SetUndifferentiatedWeightAtSpawning</span><span class="op">(</span><span class="va">empirical_weight</span><span class="op">)</span>
<span class="va">growth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_par_section.html">create_par_section</a></span><span class="op">(</span>
  section_type <span class="op">=</span> <span class="st">"growth"</span>, section_type_object <span class="op">=</span> <span class="va">growth</span>,
  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a_min"</span>, <span class="st">"a_max"</span>, <span class="st">"c"</span>, <span class="st">"lmin"</span>, <span class="st">"lmax"</span>, <span class="st">"alpha_f"</span>, <span class="st">"alpha_m"</span>, <span class="st">"beta_f"</span>, <span class="st">"beta_m"</span><span class="op">)</span>,
  par_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">10.0</span>, <span class="fl">0.3</span>, <span class="fl">5</span>, <span class="fl">50</span>, <span class="fl">2.5E-5</span>, <span class="fl">2.5E-5</span>, <span class="fl">2.9624</span>, <span class="fl">2.9624</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Maturity</span>
<span class="va">maturity</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Maturity</span><span class="op">)</span>
<span class="va">maturity</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fl">0.011488685</span>,
  <span class="fl">0.16041065</span>,
  <span class="fl">0.45232527</span>,
  <span class="fl">0.497389935</span>,
  <span class="fl">0.499869405</span>,
  <span class="fl">0.499993495</span>,
  <span class="fl">0.499999675</span>,
  <span class="fl">0.499999985</span>,
  <span class="fl">0.5</span>,
  <span class="fl">0.5</span>,
  <span class="fl">0.5</span>,
  <span class="fl">0.5</span>
<span class="op">)</span>

<span class="co"># Natural Mortality</span>
<span class="va">natural_mortality</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">NaturalMortality</span><span class="op">)</span>
<span class="va">natural_mortality</span><span class="op">$</span><span class="fu">SetValues</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="va">nages</span><span class="op">)</span><span class="op">)</span>
<span class="co"># need to add reset button to static variable so you can run again</span>

<span class="co"># define Movement (only 1 area in this model)</span>
<span class="va">movement</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Movement</span><span class="op">)</span>
<span class="va">movement</span><span class="op">$</span><span class="va">connectivity_females</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span>
<span class="va">movement</span><span class="op">$</span><span class="va">connectivity_males</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span>
<span class="va">movement</span><span class="op">$</span><span class="va">connectivity_recruits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span><span class="op">)</span></code></pre></div>
<p>Next we define the functions related to fishing, i.e. fishing mortality and selectivity.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Fishing Mortality</span>
<span class="va">fishing_mortality</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">FishingMortality</span><span class="op">)</span>
<span class="va">fishing_mortality</span><span class="op">$</span><span class="va">estimate</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">fishing_mortality</span><span class="op">$</span><span class="va">phase</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">fishing_mortality</span><span class="op">$</span><span class="va">min</span> <span class="op">&lt;-</span> <span class="fl">1e-8</span>
<span class="va">fishing_mortality</span><span class="op">$</span><span class="va">max</span> <span class="op">&lt;-</span> <span class="fl">30</span>
<span class="va">fishing_mortality</span><span class="op">$</span><span class="fu">SetValues</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Selectivity Model</span>
<span class="va">fleet_selectivity</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">LogisticSelectivity</span><span class="op">)</span>
<span class="va">fleet_selectivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_par_section.html">create_par_section</a></span><span class="op">(</span><span class="st">"selectivity"</span>, <span class="va">fleet_selectivity</span>,
  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a50"</span>, <span class="st">"slope"</span><span class="op">)</span>,
  par_lo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0001</span><span class="op">)</span>, par_hi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10.0</span>, <span class="fl">5.0</span><span class="op">)</span>, par_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span>,
  par_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span>
<span class="op">)</span>


<span class="va">survey_selectivity</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">LogisticSelectivity</span><span class="op">)</span>
<span class="va">survey_selectivity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_par_section.html">create_par_section</a></span><span class="op">(</span><span class="st">"selectivity"</span>, <span class="va">survey_selectivity</span>,
  par_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a50"</span>, <span class="st">"slope"</span><span class="op">)</span>,
  par_lo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.0001</span><span class="op">)</span>, par_hi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10.0</span>, <span class="fl">5.0</span><span class="op">)</span>, par_phase <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,
  par_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.3</span><span class="op">)</span>
<span class="op">)</span>


<span class="va">survey2_selectivity</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">AgeBasedSelectivity</span><span class="op">)</span>
<span class="va">survey2_selectivity</span><span class="op">$</span><span class="va">estimated</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">survey2_selectivity</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="va">nages</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="creating-the-population" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-population" class="anchor"></a>Creating the population</h2>
<p>Now that the classes for parameter values and movement have been created, you can create a population class and add the relevant classes.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Population</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">y</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">nyears</span><span class="op">)</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">population</span><span class="op">$</span><span class="fu">AddMovement</span><span class="op">(</span><span class="va">movement</span><span class="op">$</span><span class="va">id</span>, <span class="va">y</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">population</span><span class="op">$</span><span class="fu">AddNaturalMortality</span><span class="op">(</span><span class="va">natural_mortality</span><span class="op">$</span><span class="va">id</span>, <span class="va">area1</span><span class="op">$</span><span class="va">id</span>, <span class="st">"undifferentiated"</span><span class="op">)</span>
<span class="va">population</span><span class="op">$</span><span class="fu">AddMaturity</span><span class="op">(</span><span class="va">maturity</span><span class="op">$</span><span class="va">id</span>, <span class="va">area1</span><span class="op">$</span><span class="va">id</span>, <span class="st">"undifferentiated"</span><span class="op">)</span>
<span class="va">population</span><span class="op">$</span><span class="fu">AddRecruitment</span><span class="op">(</span><span class="va">recruitment</span><span class="op">$</span><span class="va">id</span>, <span class="fl">1</span>, <span class="va">area1</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">population</span><span class="op">$</span><span class="fu">SetInitialDeviations</span><span class="op">(</span><span class="va">initial_deviations</span><span class="op">$</span><span class="va">id</span>, <span class="va">area1</span><span class="op">$</span><span class="va">id</span>, <span class="st">"undifferentiated"</span><span class="op">)</span>
<span class="va">population</span><span class="op">$</span><span class="fu">SetGrowth</span><span class="op">(</span><span class="va">growth</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></code></pre></div>
</div>
<div id="adding-data-to-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-data-to-the-model" class="anchor"></a>Adding data to the model</h2>
<p>Next, use the data classes (<code>IndexData</code> and <code>AgeCompData</code>) to add values, error, and sample sizes for each data set. Indices and error values are the same length as the number of years, <code>{r} nyears</code>. Age comp data are passed as a vector of length <code>nages</code> x <code>nyears</code>. The <code>sample_size</code> vectors should be of length <code>nyears</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Index data</span>
<span class="va">catch_index</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">IndexData</span><span class="op">)</span>
<span class="va">catch_index</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">catch_index</span><span class="op">$</span><span class="va">values</span>
<span class="va">catch_index</span><span class="op">$</span><span class="va">error</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">catch_index</span><span class="op">$</span><span class="va">error</span>

<span class="va">survey_index</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">IndexData</span><span class="op">)</span>
<span class="va">survey_index</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">survey_index</span><span class="op">$</span><span class="va">values</span>
<span class="va">survey_index</span><span class="op">$</span><span class="va">error</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">survey_index</span><span class="op">$</span><span class="va">error</span>


<span class="co"># Age Comp Data</span>
<span class="va">catch_comp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">AgeCompData</span><span class="op">)</span>
<span class="va">catch_comp</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">catch_comp</span><span class="op">$</span><span class="va">values</span>
<span class="va">catch_comp</span><span class="op">$</span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">catch_comp</span><span class="op">$</span><span class="va">sample_size</span>



<span class="va">survey_comp</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">AgeCompData</span><span class="op">)</span>
<span class="va">survey_comp</span><span class="op">$</span><span class="va">values</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">survey_comp</span><span class="op">$</span><span class="va">values</span>
<span class="va">survey_comp</span><span class="op">$</span><span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="va">input_data</span><span class="op">$</span><span class="va">survey_comp</span><span class="op">$</span><span class="va">sample_size</span></code></pre></div>
</div>
<div id="defining-fleets" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-fleets" class="anchor"></a>Defining fleets</h2>
<p>To make each fishing fleet, you can use the <code>make_fleet()</code> function. This takes the fishery data associated with that fleet, the selectivity associated with that fleet, the area, and fishing mortality parameters and returns an <code>r4mas</code> fleet object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># NLL models</span>
<span class="va">fleet_index_comp_nll</span> <span class="op">&lt;-</span> <span class="va">survey_index_comp_nll</span> <span class="op">&lt;-</span> <span class="va">survey2_index_comp_nll</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Lognormal</span><span class="op">)</span>
<span class="va">fleet_age_comp_nll</span> <span class="op">&lt;-</span> <span class="va">survey_age_comp_nll</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">MultinomialRobust</span><span class="op">)</span>


<span class="co"># Fleet</span>
<span class="va">fleet</span> <span class="op">&lt;-</span> <span class="fu">make_fleet</span><span class="op">(</span><span class="va">r4mas</span>, <span class="va">catch_comp</span>, <span class="va">catch_index</span>, <span class="va">fleet_selectivity</span>, <span class="va">area1</span>, <span class="va">fishing_mortality</span><span class="op">)</span>

<span class="co"># Survey</span>
<span class="va">survey</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">Survey</span><span class="op">)</span>
<span class="va">survey</span><span class="op">$</span><span class="fu">AddAgeCompData</span><span class="op">(</span><span class="va">survey_comp</span><span class="op">$</span><span class="va">id</span>, <span class="st">"undifferentiated"</span><span class="op">)</span>
<span class="va">survey</span><span class="op">$</span><span class="fu">AddIndexData</span><span class="op">(</span><span class="va">survey_index</span><span class="op">$</span><span class="va">id</span>, <span class="st">"undifferentiated"</span><span class="op">)</span>
<span class="va">survey</span><span class="op">$</span><span class="fu">SetIndexNllComponent</span><span class="op">(</span><span class="va">survey_index_comp_nll</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">survey</span><span class="op">$</span><span class="fu">SetAgeCompNllComponent</span><span class="op">(</span><span class="va">survey_age_comp_nll</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">survey</span><span class="op">$</span><span class="fu">AddSelectivity</span><span class="op">(</span><span class="va">survey_selectivity</span><span class="op">$</span><span class="va">id</span>, <span class="fl">1</span>, <span class="va">area1</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">survey</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fl">0.0001</span>
<span class="va">survey</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">min</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">survey</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">max</span> <span class="op">&lt;-</span> <span class="fl">10</span>
<span class="va">survey</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">estimated</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">survey</span><span class="op">$</span><span class="va">q</span><span class="op">$</span><span class="va">phase</span> <span class="op">&lt;-</span> <span class="fl">1</span></code></pre></div>
</div>
<div id="build-and-run-the-model-and-write-output" class="section level2">
<h2 class="hasAnchor">
<a href="#build-and-run-the-model-and-write-output" class="anchor"></a>Build and run the model and write output</h2>
<p>Finally, we create a <code>MASModel</code> object and add the relevant model configuration parameters, fleets, surveys, and populations to the model object. We call the <code>Run()</code> method to run the model and then write the output to a .json file.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># build the MAS model</span>
<span class="va">mas_model</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">r4mas</span><span class="op">$</span><span class="va">MASModel</span><span class="op">)</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">nyears</span> <span class="op">&lt;-</span> <span class="va">nyears</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">nseasons</span> <span class="op">&lt;-</span> <span class="va">nseasons</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">nages</span> <span class="op">&lt;-</span> <span class="va">nages</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">extended_plus_group</span> <span class="op">&lt;-</span> <span class="fl">15</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="va">ages</span>
<span class="va">mas_model</span><span class="op">$</span><span class="fu">AddFleet</span><span class="op">(</span><span class="va">fleet</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">catch_season_offset</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">mas_model</span><span class="op">$</span><span class="va">spawning_season_offset</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>
<span class="va">population</span><span class="op">$</span><span class="va">sex_ratio</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>

<span class="va">mas_model</span><span class="op">$</span><span class="fu">AddSurvey</span><span class="op">(</span><span class="va">survey</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">mas_model</span><span class="op">$</span><span class="fu">AddPopulation</span><span class="op">(</span><span class="va">population</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>


<span class="co">##########</span>
<span class="co"># Run the model</span>

<span class="va">mas_model</span><span class="op">$</span><span class="fu">Run</span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span><span class="op">(</span><span class="va">mas_model</span><span class="op">$</span><span class="fu">GetOutput</span><span class="op">(</span><span class="op">)</span>,
  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"r4MAS"</span><span class="op">)</span>,
    <span class="st">"mas_s2_output.json"</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="read-in-model-output" class="section level2">
<h2 class="hasAnchor">
<a href="#read-in-model-output" class="anchor"></a>Read in model output</h2>
<p>We use the <code>jsonlite</code> package to read in model output. This creates a list in your R environment with the associated output values and estimates.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://arxiv.org/abs/1403.2805">jsonlite</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: jsonlite</code></pre>
<pre><code>## Warning: package 'jsonlite' was built under R version 4.0.5</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">json_loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"r4MAS"</span><span class="op">)</span>,
  <span class="st">"mas_s2_output.json"</span>
<span class="op">)</span>
<span class="va">json_output</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/read_json.html">read_json</a></span><span class="op">(</span><span class="va">json_loc</span><span class="op">)</span>

<span class="va">years</span> <span class="op">&lt;-</span> <span class="va">json_output</span><span class="op">$</span><span class="va">nyears</span>
<span class="va">ages</span> <span class="op">&lt;-</span> <span class="va">json_output</span><span class="op">$</span><span class="va">nages</span>
<span class="va">popdy</span> <span class="op">&lt;-</span> <span class="va">json_output</span><span class="op">$</span><span class="va">population_dynamics</span>


<span class="va">survey_biomass_f</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">popdy</span><span class="op">$</span><span class="va">surveys</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">females</span><span class="op">$</span><span class="va">survey_biomass</span><span class="op">$</span><span class="va">values</span><span class="op">)</span>


<span class="co"># View the estimated values</span>
<span class="va">popdy</span><span class="op">$</span><span class="va">fleet</span><span class="op">$</span><span class="va">undifferentiated</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># popdy$survey$undifferentiated</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christine Stawitz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
